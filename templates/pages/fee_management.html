{% extends "base.html" %}
{% block content %}
<h3>Fee Management</h3>

<form method="get" class="mb-3">
  <div class="row">
    <div class="col-md-3">
      <input type="text" name="search" value="{{ request.GET.search }}"
             class="form-control" placeholder="Search by Student Name/Email">
    </div>
    <div class="col-md-2">
      <select name="course" class="form-control">
        <option value="">All Courses</option>
        {% for course in courses %}
        <option value="{{ course.id }}" {% if request.GET.course == course.id|stringformat:"s" %}selected{% endif %}>
          {{ course.title }}
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <select name="batch" class="form-control">
        <option value="">All Batches</option>
        {% for batch in batches %}
        <option value="{{ batch.id }}" {% if request.GET.batch == batch.id|stringformat:"s" %}selected{% endif %}>
          {{ batch.name }} ({{ batch.course.title }})
        </option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <select name="fee_type" class="form-control">
        <option value="">All Fee Types</option>
        <option value="one_time" {% if request.GET.fee_type == "one_time" %}selected{% endif %}>One-time</option>
        <option value="installment" {% if request.GET.fee_type == "installment" %}selected{% endif %}>Installment</option>
        <option value="custom" {% if request.GET.fee_type == "custom" %}selected{% endif %}>Custom</option>
      </select>
    </div>
    <div class="col-md-2">
      <select name="status" class="form-control">
        <option value="">All Status</option>
        <option value="paid" {% if request.GET.status == "paid" %}selected{% endif %}>Paid</option>
        <option value="partial" {% if request.GET.status == "partial" %}selected{% endif %}>Partially Paid</option>
        <option value="pending" {% if request.GET.status == "pending" %}selected{% endif %}>Pending</option>
      </select>
    </div>
    <div class="col-md-1">
      <button type="submit" class="btn btn-primary w-100">Filter</button>
    </div>
  </div>
</form>

<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>#</th>
      <th>Student</th>
      <th>Course</th>
      <th>Enrollment id</th>
      <th>Fee Type</th>
      <th>Total Fee</th>
      <th>Paid Amount</th>
      <th>Pending Amount</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for enrollment in enrollments %}
    <form method="post" style="display:contents;">
      {% csrf_token %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ enrollment.student.name }}</td>
        <td>{{ enrollment.batch.course.title }} ({{ enrollment.batch.course.course_code }})</td>
        <td>{{ enrollment.roll_number }}</td>
        <td>
          <select name="fee_type" class="form-control" style="width:120px;">
            <option value="one_time" {% if enrollment.fee_type == "one_time" %}selected{% endif %}>One-time</option>
            <option value="installment" {% if enrollment.fee_type == "installment" %}selected{% endif %}>Installment</option>
            <option value="custom" {% if enrollment.fee_type == "custom" %}selected{% endif %}>Custom</option>
          </select>
        </td>
        <td>
          <input type="number" name="fee_at_enrollment" value="{{ enrollment.fee_at_enrollment }}" class="form-control" style="width:100px;">
        </td>
        <td>
          <input type="number" name="paid_amount" value="{{ enrollment.paid_amount }}" class="form-control" style="width:100px;">
        </td>
        <td>{{ enrollment.pending_amount }}</td>
        <td>
          <input type="hidden" name="enrollment_id" value="{{ enrollment.id }}">
          <button type="submit" class="btn btn-success btn-sm">Update</button>
        </td>
      </tr>
    </form>
    {% empty %}
    <tr>
      <td colspan="9" class="text-center">No enrollments found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
